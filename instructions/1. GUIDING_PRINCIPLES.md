# Guiding Principles for Rope Access Management System Development
**Version**: 1.0  
**Last Updated**: November 22, 2024  
**Status**: ACTIVE - FOUNDATIONAL DOCUMENT

## Core Development Philosophy

### "It Just Works" Principle
Every feature, every interaction, every process must work reliably 100% of the time. There is no acceptable failure rate for core functionality. Field workers depend on this system for safety documentation, time tracking, and critical communications. System failures could compromise safety, payroll accuracy, or regulatory compliance.

## 1. Safety-First Development Principles

### 1.1 Zero Compromise on Safety Features
- **Inspection forms MUST always save** - Never lose a safety inspection or FLHA assessment
- **GPS tracking MUST be accurate** - Worker location is critical for emergency response
- **Digital signatures MUST be legally binding** - Proper capture and storage for compliance
- **Safety documents MUST be immutable** - Once signed, documents cannot be altered
- **Emergency contacts MUST be accessible** - Always available even during system issues

### 1.2 Fail-Safe Defaults
- **Default to restrictive permissions** - Employees only see what they need
- **Require safety checks before work** - Cannot start work session without inspection
- **Force completion of critical fields** - Safety-critical data cannot be optional
- **Auto-save draft data** - Never lose partially completed safety forms
- **Offline capability for critical features** - Basic safety forms work without internet

### 1.3 Compliance & Audit Trail
- **Every action MUST be logged** - Complete audit trail for investigations
- **Timestamps MUST be accurate** - Use server time, never trust client
- **Records MUST be permanent** - Soft delete only, never hard delete safety data
- **Changes MUST be tracked** - Version history for all safety documents
- **Access MUST be controlled** - Role-based permissions with no exceptions

## 2. Reliability and Consistency Principles

### 2.1 Zero Data Loss
- **ALL files MUST use Object Storage** - Never use local filesystem for persistent data
- **Database transactions MUST be atomic** - Complete all-or-nothing operations
- **Work sessions MUST auto-save** - Protect against connection loss in the field
- **Time entries MUST be recoverable** - Never lose billable hours
- **GPS data MUST be cached** - Store locally until connection restored

### 2.2 Multi-Tenant Data Integrity
- **Company isolation MUST be absolute** - No data leakage between companies
- **Employee access MUST respect hierarchy** - Techs can't see manager data
- **Resident data MUST be protected** - Only linked company can access
- **Project data MUST be scoped** - Employees only see assigned projects
- **Financial data MUST be segregated** - Payroll isolated per company

### 2.3 Work Session Integrity
- **Clock-in/out MUST be verifiable** - GPS and timestamp validation
- **Drops MUST be tracked per elevation** - Accurate progress monitoring
- **Hours MUST calculate correctly** - Regular, overtime, double-time accuracy
- **Shortfalls MUST be documented** - Required explanations for missed targets
- **Multiple sessions MUST be supported** - Handle complex work patterns

## 3. Field Worker Experience Principles

### 3.1 Mobile-First Design
- **Touch targets MUST be large** - Usable with gloves on
- **Forms MUST be simple** - Minimal typing in the field
- **Loading MUST be fast** - 3G connection capable
- **Feedback MUST be immediate** - Clear success/error states
- **Navigation MUST be intuitive** - Find features without training

### 3.2 Offline Resilience
- **Critical features MUST work offline** - Safety forms, time tracking
- **Data MUST sync when connected** - Automatic background sync
- **Conflicts MUST be resolved** - Smart merge strategies
- **Status MUST be visible** - Show sync state clearly
- **Queue MUST be reliable** - Never lose offline actions

### 3.3 Error Prevention
- **Validate at entry point** - Catch errors before submission
- **Provide clear constraints** - Show limits and requirements
- **Use smart defaults** - Pre-fill logical values
- **Prevent duplicate entries** - Block double clock-ins
- **Guide correct behavior** - Make the right thing easy

## 4. System Architecture Principles

### 4.1 Dependency Chain Integrity
Every system change must consider the complete dependency chain:
```
Work Session → Drops → Projects → Timesheets → Payroll
     ↓           ↓         ↓           ↓           ↓
    GPS    →  Progress → Clients → Reports → Invoices
     ↓           ↓         ↓           ↓           ↓
  Location → Analytics → Alerts → Dashboard → Notifications
```

### 4.2 Status Management
- **Status transitions MUST be validated** - Use defined state machines
- **Status MUST drive UI** - Show/hide features based on state
- **Status MUST be synchronized** - Backend and frontend alignment
- **Status history MUST be tracked** - Who changed what and when
- **Status MUST cascade properly** - Project status affects work sessions

### 4.3 Multi-System Coordination
Before making ANY change, verify impact on:
- **Employee Management** - Roles, permissions, certifications
- **Project Tracking** - Progress, assignments, timelines
- **Safety Systems** - Inspections, FLHA, toolbox meetings
- **Time & Payroll** - Work sessions, timesheets, pay periods
- **Client Relations** - Complaints, work orders, communications
- **Document Generation** - PDFs, reports, certificates
- **Notifications** - Emails, alerts, reminders

## 5. Critical System Rules

### 5.1 Work Session Management
```typescript
// NEVER modify without understanding:
// 1. GPS validation requirements
// 2. Time calculation algorithms  
// 3. Drop tracking per elevation
// 4. Payroll integration impact
// 5. Project progress updates
```

### 5.2 Safety Documentation
```typescript
// MANDATORY requirements:
// 1. Digital signature capture and storage
// 2. PDF generation with immutable content
// 3. Timestamp accuracy for legal compliance
// 4. Multi-employee signature support
// 5. Object storage for permanent retention
```

### 5.3 Time & Payroll Calculation
```typescript
// CRITICAL calculation order:
// 1. Aggregate work sessions by date
// 2. Apply overtime thresholds (daily/weekly)
// 3. Calculate regular hours first
// 4. Calculate overtime (1.5x) next
// 5. Calculate double-time (2x) last
// 6. Never modify historical calculations
```

### 5.4 Multi-Tenant Isolation
```typescript
// ABSOLUTE requirements:
// 1. Always filter by companyId
// 2. Validate ownership before updates
// 3. Scope all queries to company
// 4. Prevent cross-company references
// 5. Audit all data access
```

## 6. Production Operations Principles

### 6.1 Zero Downtime Deployments
- **Database migrations MUST be safe** - No breaking changes
- **API versions MUST be maintained** - Support old app versions
- **Feature flags MUST be used** - Gradual rollouts
- **Rollback MUST be possible** - Quick recovery plan
- **Monitoring MUST be active** - Know issues immediately

### 6.2 Performance Standards
- **Page load < 2 seconds** - Even on slow connections
- **API response < 500ms** - For standard queries
- **Batch operations < 5 seconds** - For bulk updates
- **Report generation < 10 seconds** - For standard reports
- **Search results < 1 second** - For all search types

### 6.3 Scalability Requirements
- **Support 1000+ companies** - Multi-tenant architecture
- **Handle 10,000+ daily work sessions** - Concurrent usage
- **Store 1M+ safety documents** - Long-term retention
- **Process 100K+ time entries** - Monthly payroll runs
- **Track 50K+ gear items** - Equipment database

## 7. Code Quality Standards

### 7.1 TypeScript Strictness
- **Zero TypeScript errors allowed** - Fix all diagnostics
- **Proper null safety** - Handle undefined/null explicitly
- **Strong typing throughout** - No 'any' types
- **Type imports correct** - Proper module resolution
- **Interfaces over types** - When extending

### 7.2 Database Integrity
- **Foreign keys enforced** - Referential integrity
- **Indexes optimized** - Query performance
- **Constraints validated** - Business rules in DB
- **Transactions used** - Atomic operations
- **Deadlocks prevented** - Proper lock ordering

### 7.3 Security Requirements
- **Authentication required** - No anonymous access
- **Authorization enforced** - Role-based access
- **Input validated** - Prevent injection attacks
- **Secrets protected** - Environment variables only
- **Sessions secured** - Proper timeout and rotation

## 8. Development Workflow

### 8.1 Before Starting Work
1. **Read relevant instruction documents** in `/instructions/`
2. **Understand the complete flow** from user action to database
3. **Identify all touchpoints** affected by changes
4. **Review similar implementations** for patterns
5. **Check for existing issues** in the area

### 8.2 During Development
1. **Write tests first** - TDD for critical features
2. **Handle errors explicitly** - No silent failures
3. **Log important operations** - Aid debugging
4. **Update documentation** - Keep current
5. **Consider mobile users** - Field worker experience

### 8.3 Before Marking Complete
1. **Test all user roles** - Company, employees, residents
2. **Verify offline behavior** - Field conditions
3. **Check mobile experience** - Touch targets, performance
4. **Confirm data integrity** - Multi-tenant isolation
5. **Validate safety features** - Compliance requirements

## 9. Anti-Patterns to Avoid

### 9.1 Never Do This
❌ Store files locally without Object Storage
❌ Trust client-side time for work sessions
❌ Allow cross-company data access
❌ Skip safety form validation
❌ Hard delete safety records
❌ Calculate payroll on frontend
❌ Expose internal IDs to users
❌ Bypass role-based permissions

### 9.2 Always Do This Instead
✅ Use Object Storage for ALL files
✅ Use server timestamps exclusively
✅ Filter by companyId in ALL queries
✅ Validate ALL safety form fields
✅ Soft delete with audit trail
✅ Calculate payroll on backend only
✅ Use reference numbers for users
✅ Enforce role hierarchy strictly

## 10. System Health Monitoring

### Daily Checks
- [ ] Work session success rate (>99%)
- [ ] GPS tracking accuracy (>95%)
- [ ] Safety form completion (100%)
- [ ] File upload success (>99%)
- [ ] Time calculation accuracy (100%)

### Weekly Verification
- [ ] No stuck work sessions
- [ ] No orphaned time entries
- [ ] No missing GPS data
- [ ] Payroll calculations correct
- [ ] Document generation working

### Monthly Audit
- [ ] Multi-tenant isolation verified
- [ ] Permission system intact
- [ ] Backup systems operational
- [ ] Compliance reports accurate
- [ ] Performance within SLA

## 11. Emergency Response

### If Work Sessions Fail
1. Check GPS service status
2. Verify database connectivity
3. Review calculation logic
4. Check for timezone issues
5. Enable manual entry backup

### If Safety Forms Lost
1. Check Object Storage connection
2. Verify form validation
3. Review auto-save mechanism
4. Check offline queue
5. Restore from backups

### If Payroll Incorrect
1. Audit work session data
2. Verify calculation rules
3. Check pay period configuration
4. Review overtime thresholds
5. Recalculate affected periods

### If Multi-Tenant Breach
1. Immediately isolate affected data
2. Audit all recent queries
3. Review permission changes
4. Notify affected companies
5. Implement additional filters

## 12. Continuous Improvement

### Code Reviews Focus On
- Safety feature reliability
- Multi-tenant isolation
- Field worker usability
- Performance optimization
- Error handling completeness

### Testing Priorities
1. Safety documentation accuracy
2. Time tracking precision
3. Multi-tenant data isolation
4. Offline functionality
5. GPS accuracy

### Documentation Updates
- Update when patterns change
- Document all critical decisions
- Record safety considerations
- Share field worker feedback
- Maintain troubleshooting guides

---

## Remember: Field Workers Depend on This System

Rope access technicians work in dangerous conditions. They depend on this system for:
- Safety documentation that could save lives
- Accurate time tracking for fair pay
- Reliable communication with supervisors
- Equipment tracking for maintenance
- Emergency contact accessibility

Every bug, every failure, every confusing interface could:
- Compromise worker safety
- Delay emergency response
- Cause payroll errors
- Create compliance violations
- Damage client relationships

**Code with care. Test with thoroughness. Deploy with confidence.**

**Our standard: It Just Works. For every worker. Every time. No exceptions.**