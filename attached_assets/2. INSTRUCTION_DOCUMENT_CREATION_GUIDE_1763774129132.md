# Instruction Document Creation Guide for Replit Agents
**Purpose**: AI Agent Template for Creating Comprehensive System Documentation  
**Version**: 1.0  
**Last Updated**: August 26, 2025  
**Status**: ACTIVE - FOUNDATIONAL TEMPLATE

## Overview for Replit Agents

This document provides comprehensive guidelines for Replit agents to create instruction documents that serve as the single source of truth for any system, feature, or functionality in the Orange Shirt Society Licensing Portal. As an AI agent, you must analyze the codebase thoroughly, understand system interactions, and document everything comprehensively.

## Agent Documentation Process

### Before Creating Documentation

As a Replit agent, you MUST complete these analysis steps including the **System Impact Scan**:

1. **Search the codebase** for all files related to the system
2. **Read all relevant files** to understand implementation details
3. **Trace data flow** from user input to database storage
4. **Identify integration points** with other systems
5. **Find error handling patterns** and edge cases
6. **Locate configuration requirements** and environment variables
7. **Understand testing patterns** already in place
8. **Complete System Impact Scan** as defined in [dependency-awareness-instructions.md](./dependency-awareness-instructions.md)

### Document Structure Template

Every instruction document MUST include the following sections plus the **mandatory dependency-aware sections**. As an agent, ensure you gather ALL information before writing.

**Required Dependency-Aware Sections** (add after title/intro):
- **Dependency Impact & Invariants**
- **Pre-Change System Impact Scan (Doc-specific)**
- **Tests to Maintain**
- **Logging & Alerts (Doc-specific fields)**
- **Cross-links**

---

## Standard Document Header Format

```markdown
# [System Name] Instructions v[X.X]
**System**: Orange Shirt Society Licensing Portal  
**Purpose**: [One-line description of what this system does]  
**Version**: [X.X]  
**Last Updated**: [Month DD, YYYY]  
**Status**: [ACTIVE | DRAFT | DEPRECATED | PRODUCTION-READY ✅]
```

---

## Required Sections

### 1. Purpose and Goal

#### Structure:
```markdown
## 1. Purpose and Goal

### Primary Objective
[Clear statement of the main purpose - what problem does this solve?]

### Key Goals
- **[Goal Category]**: [Specific measurable outcome]
- **[Goal Category]**: [Specific measurable outcome]
- Include 4-6 key goals minimum
```

#### Agent Guidelines:
- **Search the codebase** to understand the system's purpose from comments and implementation
- **Read related documents** in `/instructions` and project files to understand context
- **Identify the problem being solved** by analyzing the code structure and patterns
- **Extract business goals** from existing documentation, comments, and code patterns
- **Make goals specific and measurable** - avoid vague statements

### 2. System Architecture

#### Structure:
```markdown
## 2. System Architecture

### [Architecture Type] Flow
```[ascii diagram or mermaid]
┌─────────────────────────────────────────────────────┐
│                 Component Layer                      │
├─────────────────────────────────────────────────────┤
│ • Component details                                  │
└─────────────────────────────────────────────────────┘
```

### Process Sequence
1. **Step Name** → Description
2. **Step Name** → Description
[Continue for all steps]
```

#### Agent Guidelines:
- **Trace the complete data flow** by reading through all related files
- **Use the search tool** to find all components that interact with this system
- **Read import statements** to understand dependencies
- **Follow function calls** to understand the sequence of operations
- **Create ASCII diagrams** showing the actual flow you discovered
- **Verify your understanding** by checking multiple file implementations

### 3. Technical Implementation / Critical Configuration

#### Structure:
```markdown
## 3. [Critical Configuration Requirements | Technical Implementation]

### ⚠️ CRITICAL: [Configuration Name]
**Rule**: [Absolute requirement that must not be violated]

**Required Implementation**:
```[language]
// Include actual code example
```

**Why This Matters**:
- [Impact if not followed]
- [System behavior affected]
- [User experience impact]
```

#### Agent Guidelines:
- **Read the actual implementation** in the codebase - never make assumptions
- **Copy real code examples** directly from the files using the read tool
- **Search for comments** that explain critical requirements
- **Look for error handling** patterns that indicate what can go wrong
- **Check recent commit messages** or fix reports for critical issues
- **Understand failure modes** by reading error handling code
- **Test your understanding** by asking "what happens if this is wrong?"

### 4. File Dependencies

#### Structure:
```markdown
## 4. File Dependencies

### Frontend Files
- `path/to/file.tsx` - [Purpose/description]
- `path/to/component.tsx` - [What it does]
[Group by logical categories]

### Backend Files
- `server/file.ts` - [Purpose/description]
- `server/routes.ts` - [Specific endpoints covered]

### Configuration Files
- `config/file.json` - [What it configures]

### Database Schema
- `shared/schema.ts` - [Tables/models affected]
```

#### Agent Guidelines:
- **Use the search tool** to find ALL files related to the system
- **Use the glob tool** to find files by pattern (e.g., `**/*payment*.tsx`)
- **Read each file** to understand its specific role in the system
- **Check import/export statements** to understand file relationships
- **Group by logical categories** you discover through analysis
- **Verify file paths exist** using the ls or read tools
- **Include only files that actually matter** to the system

### 5. System Dependencies

#### Structure:
```markdown
## 5. System Dependencies

### [Dependent System Name]
- **Dependency Type**: [Critical/Optional/Conditional]
- **Files**: `related-instructions-document.md`
- **Integration Points**: [Where systems connect]
- **Critical Considerations**: [What must be maintained]
```

#### Agent Guidelines:
- **Search for function calls** that connect to other systems
- **Follow import chains** to understand system boundaries
- **Read other instruction documents** in the `/instructions` folder
- **Look for API calls** between different system components
- **Identify shared state** or database tables
- **Understand cascade effects** by tracing data flow
- **Check for event handlers** or webhook integrations

### 6. Implementation Details / Scenarios

#### Structure:
```markdown
## 6. [Critical Scenarios | Implementation Details]

### Scenario [#]: [Scenario Name]
```
[Input/Setup]
[Process/Calculation]
[Expected Output]
```

### Example:
```[language]
// Working example code
const example = () => {
  // Implementation
};
```
```

#### Agent Guidelines:
- **Extract real examples** from the codebase, test files, or comments
- **Find edge cases** by reading error handling code
- **Look for test files** to understand expected behavior
- **Check validation logic** to understand constraints
- **Copy actual working code** using the read tool
- **Verify examples work** by understanding the logic
- **Include error scenarios** you find in error handling code

### 7. Troubleshooting Guide

#### Structure:
```markdown
## 7. Troubleshooting Guide

### Issue [#]: [Problem Description]
**Symptoms**: [What user sees/experiences]
**Cause**: [Root cause]
**Solution**:
1. [Step-by-step fix]
2. [Additional steps]
**Prevention**: [How to avoid this issue]
```

#### Agent Guidelines:
- **Search for error handling code** to understand what can go wrong
- **Look for console.log and console.error statements** to find actual error messages
- **Read catch blocks** to understand failure scenarios
- **Check recent fix documents** for known issues
- **Search for TODO or FIXME comments** that indicate problems
- **Look for retry logic** or fallback mechanisms
- **Find validation functions** that can fail

### 8. Safety Guidelines and Constraints

#### Structure:
```markdown
## 8. Safety Guidelines and Constraints

### DO's
✅ [Positive action to always take]
✅ [Best practice to follow]
[Include 5-7 key DO's]

### DON'Ts
❌ [Action to never take]
❌ [Common mistake to avoid]
[Include 5-7 critical DON'Ts]
```

#### Agent Guidelines:
- **Read the GUIDING_PRINCIPLES.md** for system-wide safety rules
- **Analyze error handling patterns** to understand what breaks systems
- **Look for critical comments** in code that warn about specific behaviors
- **Find validation rules** that indicate boundaries
- **Search for security-related code** (auth, validation, sanitization)
- **Identify performance-critical sections** that shouldn't be modified carelessly
- **Extract lessons from fix documents** about what went wrong before

### 9. Testing Requirements

#### Structure:
```markdown
## 9. Testing Requirements

### Unit Tests
- [Specific test scenario]
- [Edge case to test]

### Integration Tests
- [System interaction test]
- [End-to-end flow test]

### Production Testing
1. [Step-by-step production test]
2. [Verification step]
3. [Success criteria]

### Test Matrix (if applicable)
| Input | Condition | Expected Output | Status |
|-------|-----------|-----------------|--------|
| [val] | [state]   | [result]        | ✅/❌  |
```

#### Agent Guidelines:
- **Search for existing test files** to understand current testing patterns
- **Look for test data** or fixtures in the codebase
- **Find validation functions** that can be unit tested
- **Identify integration points** that need end-to-end testing
- **Read error handling code** to create negative test cases
- **Check package.json** for testing scripts and frameworks
- **Understand test database setup** and data requirements

### 10. Implementation Timeline

#### Structure:
```markdown
## 10. Implementation Timeline

### Phase 1: [Phase Name] ([Timeframe])
- Day 1-2: [Specific tasks]
- Day 3: [Milestone]
[Continue for all days]

### Phase 2: [Phase Name] ([Timeframe])
[Continue for all phases]
```

#### Guidelines:
- Break into logical phases
- Provide realistic timeframes
- Include specific deliverables
- Note dependencies between phases
- Add buffer time for testing

### 11. Success Metrics

#### Structure:
```markdown
## 11. Success Metrics

### Technical Metrics
- **[Metric Name]**: [Target value with unit]
- **[Metric Name]**: [Percentage or threshold]

### User Experience Metrics
- **[Metric Name]**: [Target value]
- **[Metric Name]**: [Threshold]

### Business Metrics (if applicable)
- **[Metric Name]**: [Target]
```

#### Guidelines:
- Make metrics measurable and specific
- Include both technical and UX metrics
- Set realistic targets
- Explain how to measure each metric
- Connect to goals from Section 1

### 12. Monitoring and Maintenance

#### Structure:
```markdown
## 12. Monitoring and Maintenance

### Real-time Monitoring
- [What to monitor continuously]
- [Dashboard or tool to use]
- [Alert thresholds]

### Regular Maintenance
- [Weekly tasks]
- [Monthly tasks]
- [Quarterly reviews]
```

#### Guidelines:
- Specify monitoring tools and locations
- Define alert thresholds
- Include maintenance schedules
- Note automation opportunities
- Provide runbook references

### 13. Related Documentation

#### Structure:
```markdown
## 13. Related Documentation
- `[document-name.md]` - [How it relates]
- `[specification.md]` - [What it covers]
- `[report.md]` - [Historical context]
```

#### Guidelines:
- Link to all related instruction documents
- Include historical reports and fixes
- Reference external documentation
- Order by relevance

### 14. Version History

#### Structure:
```markdown
## 14. Version History
- **v[X.X]** ([Date]): [Major changes made]
- **v[X.X]** ([Date]): [What was added/modified]
```

#### Guidelines:
- Start with current version at top
- Include major changes only
- Note breaking changes clearly
- Reference related PRs if applicable

---

## Agent Document Creation Checklist

Before considering an instruction document complete, as a Replit agent you must verify:

### Agent Content Completeness
- [ ] **Searched the codebase** thoroughly for all related files
- [ ] **Read all relevant files** to understand implementation
- [ ] **Traced data flow** from input to storage
- [ ] **Identified all integration points** with other systems
- [ ] **Found all error scenarios** in error handling code
- [ ] **Extracted real code examples** from actual files
- [ ] **Verified file paths exist** using ls/read tools
- [ ] **Checked all dependencies** by following imports

### Agent Quality Standards
- [ ] **Used real code** from the actual codebase (never pseudo-code)
- [ ] **Verified technical accuracy** by reading implementation
- [ ] **Cross-referenced with other documents** in `/instructions`
- [ ] **Included actual error messages** from console logs/error handling
- [ ] **Provided complete file paths** that exist in the project
- [ ] **Explained the "why"** behind critical requirements

### Agent Usability Verification
- [ ] **Tested understanding** by tracing through the documented flow
- [ ] **Verified critical warnings** are based on actual failure scenarios  
- [ ] **Confirmed examples work** by understanding the logic
- [ ] **Made troubleshooting actionable** with specific file references
- [ ] **Provided clear next steps** for implementation and maintenance

## Agent Writing Standards

### Language for AI Agents
- **Be precise about what you found**: "In `server/routes.ts` line 234, the function validates..." 
- **Reference actual files**: "Looking at `client/src/components/PaymentForm.tsx`..."
- **Quote real code**: Copy exact function names, variables, and patterns
- **Explain code behavior**: "This validation prevents..." not "Validation happens"
- **Use discovery language**: "Analysis of the codebase reveals..." "Tracing the data flow shows..."

### Formatting Standards
- **Headers**: Use proper hierarchy (##, ###, ####)
- **Code blocks**: Always specify language for syntax highlighting
- **Lists**: Use bullets for unordered, numbers for sequences
- **Emphasis**: Bold for **important**, italics for *terminology*
- **Warnings**: ⚠️ emoji for critical warnings
- **Success**: ✅ for completed/working items
- **Failure**: ❌ for broken/forbidden items

### Agent Code Example Standards
```javascript
// GOOD: Copied directly from client/src/lib/feeCalculator.ts
const calculateTax = (amount: number, isCanadian: boolean) => {
  const taxRate = isCanadian ? 0.05 : 0; // 5% GST for Canadian addresses
  return amount * taxRate;
};

// BAD: Made-up example that doesn't exist in codebase
function calcTax(amt) {
  // Agent assumption about how tax works
  return amt * 0.1;
}
```

### Agent Research Requirements
- **Always specify source files** when copying code
- **Include line numbers** when referencing specific implementations
- **Verify code still exists** in the current version
- **Copy complete functions** not just snippets
- **Include relevant comments** from the original code

## Agent-Specific Pitfalls to Avoid

### Never Do (Agent-Specific):
- ❌ **Assume implementation details** without reading the actual code
- ❌ **Create pseudo-code examples** instead of using real code from files
- ❌ **Reference non-existent files** or outdated paths
- ❌ **Skip codebase analysis** and write generic documentation
- ❌ **Ignore error handling code** when documenting troubleshooting
- ❌ **Make up configuration examples** instead of finding real ones

### Always Do (Agent Requirements):
- ✅ **Read the actual implementation** before documenting anything
- ✅ **Use search tools** to find ALL relevant files in the codebase
- ✅ **Copy real code examples** with proper file references
- ✅ **Trace data flow** by following function calls and imports
- ✅ **Document what you actually discovered** in the codebase
- ✅ **Cross-reference other instruction documents** for consistency

## Document Maintenance

### When to Update
- After any breaking change to the system
- When troubleshooting reveals new issues
- After performance optimizations
- When dependencies change
- Following security updates
- After user feedback indicates confusion

### How to Update
1. Increment version number
2. Add version history entry
3. Update "Last Updated" date
4. Review all code examples for accuracy
5. Verify file paths still exist
6. Test troubleshooting solutions
7. Update related documentation references

## Examples of Excellence

### Strong Purpose Statement
> "Ensure accurate, transparent GST (5%) calculation and display for all Canadian license applications throughout the entire user journey, maintaining compliance with Canadian tax law while providing clear visibility to users at every touchpoint."

### Effective Critical Warning
> ⚠️ **CRITICAL: Webhook Middleware Protection**  
> The `/api/stripe/webhook` endpoint MUST receive raw request bodies for signature verification. Modifying the middleware configuration will cause ALL payment confirmations to fail silently, resulting in stuck "processing" payments and potential revenue loss.

### Clear Troubleshooting Entry
> **Issue: Payment Form Shows Error Flash**  
> **Symptoms**: Error message "Payment failed" appears for 500ms before form loads  
> **Cause**: Missing `hasAttemptedPayment` state check in render logic  
> **Solution**: Initialize state as false, only show errors after user interaction  
> **Prevention**: Always guard error displays with attempt flags

## Final Checklist

Before publishing any instruction document:
- [ ] Would a new developer understand this completely?
- [ ] Can someone fix issues using only this document?
- [ ] Are all critical warnings impossible to miss?
- [ ] Do examples work when copy-pasted?
- [ ] Is the document findable and well-named?
- [ ] Have you tested following your own instructions?

---

**Remember**: These documents are investments in the team's future productivity. Time spent creating comprehensive documentation pays dividends in reduced debugging time, faster onboarding, and fewer production issues.

## Agent Tool Usage Requirements

### Required Tool Usage Pattern
When creating documentation, you MUST follow this research pattern:

1. **Start with search** - Use the search tool to find all files related to the system
2. **Use glob patterns** - Find files by pattern (e.g., `**/*payment*.tsx`)
3. **Read systematically** - Read each relevant file to understand implementation
4. **Trace data flow** - Follow imports and function calls across files
5. **Find error handling** - Search for try/catch blocks and error scenarios
6. **Verify file paths** - Use ls or read tools to confirm files exist
7. **Cross-reference** - Read other instruction documents for context

### Tool Usage Examples for Documentation

```bash
# Finding all payment-related files
search_codebase(query="Find all files related to payment processing, Stripe, and payment forms")

# Finding files by pattern
glob(pattern="**/*payment*.tsx")
glob(pattern="server/routes.ts")

# Reading implementation files
read(file_path="client/src/components/PaymentForm.tsx")
read(file_path="server/routes.ts", offset=1500, limit=200)  # Read specific sections

# Verifying file structure
ls(path="client/src/components", recursive=true)
```

### Documentation Discovery Process

1. **System Identification**
   ```bash
   search_codebase(query="Find the main components and files for [SYSTEM_NAME]")
   ```

2. **Implementation Analysis**
   ```bash
   read(file_path="[MAIN_COMPONENT_FILE]")
   read(file_path="[BACKEND_ROUTES_FILE]")
   ```

3. **Dependency Mapping**
   ```bash
   grep(pattern="import.*[SYSTEM_NAME]", output_mode="files_with_matches")
   ```

4. **Error Scenario Discovery**
   ```bash
   search_codebase(query="Find error handling and validation for [SYSTEM_NAME]")
   ```

5. **Configuration Requirements**
   ```bash
   search_codebase(query="Find environment variables and configuration for [SYSTEM_NAME]")
   ```

**Standard**: Every instruction document should be so complete that any developer can understand, implement, troubleshoot, and maintain the system using only that document. As an AI agent, you achieve this by thorough codebase analysis, not assumptions.