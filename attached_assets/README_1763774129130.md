# Orange Shirt Society Licensing Portal

A comprehensive licensing portal for the Orange Shirt Society that facilitates the "Every Child Matters" trademark usage application process. The platform provides a culturally sensitive technological solution for streamlining trademark licensing requests with robust administrative tools.

## Project Overview

This application provides:

- **Multi-pathway licensing system** supporting Personal Use, Educational, Small/Medium/Large Business, Non-Profit, Artist, and Certified Reseller applications
- **Intelligent fee calculation** based on license type, usage intent, product selection, and geographic scope
- **Secure payment processing** through Stripe with comprehensive coupon system and e-transfer support
- **Production-ready email system** with queue-based delivery, duplicate prevention, and BCC functionality
- **Administrative interface** for application review, approval, analytics, and license monitoring
- **Automated document generation** for certificates, agreements, and receipts with QR codes
- **Public Licensed Seller Directory** with privacy-protected listings
- **AI-powered FAQ chatbot** with dynamic content management
- **Comprehensive status tracking** across all application and payment workflows
- **Object storage integration** for secure file uploads and digital asset management
- **License renewal system** with automated reminder notifications

## Technology Stack

- **Frontend**: React.js with TypeScript, Tailwind CSS, shadcn/ui components, Wouter routing
- **Backend**: Express.js, Node.js with TypeScript ES modules
- **Database**: PostgreSQL with Drizzle ORM (Neon serverless)
- **Payment Processing**: Stripe with webhook integration and comprehensive coupon system
- **Email System**: SendGrid with queue-based delivery and enhanced deliverability
- **File Storage**: Replit Object Storage with Google Cloud Storage backend
- **PDF Generation**: PDFKit for certificates, agreements, and receipts
- **Authentication**: Passport.js with local strategy and session management
- **Analytics**: Google Tag Manager/GA4 integration with internal dashboard metrics

## Getting Started

### Prerequisites

- Node.js (v20+)
- PostgreSQL database
- Stripe account (for payment processing)

### Installation

1. Clone the repository:
   ```
   git clone https://github.com/cortex8/OSS-Trademark-Licensing-Portal.git
   cd OSS-Trademark-Licensing-Portal
   ```

2. Install dependencies:
   ```
   npm install
   ```

3. Set up environment variables:
   Create a `.env` file with the following variables:
   ```
   DATABASE_URL=postgresql://user:password@localhost:5432/oss_licensing
   STRIPE_SECRET_KEY=your_stripe_secret_key
   VITE_STRIPE_PUBLIC_KEY=your_stripe_public_key
   ```

4. Set up the database:
   ```
   npm run db:push
   ```

5. Start the development server:
   ```
   npm run dev
   ```

## Documentation & Reference Guides

This project includes comprehensive documentation for maintaining and extending the system:

### Core Functionality Documentation (`instructions/core-functionality/`)

**Foundation Documents:**
- **`1. GUIDING_PRINCIPLES.md`** - Core development philosophy and standards
- **`2. INSTRUCTION_DOCUMENT_CREATION_GUIDE.md`** - Documentation standards and guidelines
- **`3. ADMIN_STATUS_REFERENCE_GUIDE.md`** - Complete status management reference
- **`4. PATHWAY_DEFINITION_DOCUMENT.md`** - License pathway specifications
- **`5. DEPENDENCY-AWARENESS-INSTRUCTIONS.md`** - System-wide impact awareness

**System Component Instructions:**
- **`email-system-instructions-v2.0.md`** - Production-ready email system with queue-based delivery and duplicate prevention
- **`payment-system-instructions-v2.0.md`** - Stripe integration and payment processing workflows
- **`coupon-system-instructions-v2.0.md`** - Complete coupon logic and validation rules
- **`status-system-instructions-v3.0.md`** - Application and payment status management
- **`tax-system-instructions-v2.0.md`** - Tax calculation principles and implementation
- **`border-style-consistency-instructions-v2.0.md`** - UI consistency and standardized border styling across all components
- **`database-schema-instructions.md`** - Complete PostgreSQL database schema with Drizzle ORM implementation
- **`authentication-instructions.md`** - Session-based authentication system with role-based access control
- **`file-upload-instructions.md`** - Object storage integration patterns
- **`document-generation-instructions.md`** - PDF generation for certificates and agreements

**Reference Documents:**
- **`DISPLAY_LOGIC_REFERENCE.md`** - UI display patterns and conditional logic
- **`documentation-roadmap.md`** - Documentation completeness tracking and planning

### Specialized Instructions (`instructions/`)

- **`comprehensive-analytics-system-instructions-v3.0.md`** - Complete analytics system covering internal business intelligence, user behavior tracking, and Google Analytics/GTM integration with data accuracy and consistency requirements
- **`accounting_efficiency_instructions.md`** - Financial reporting and bookkeeping integration
- **`employee_mentions_instructions.md`** - Staff reference and communication protocols
- **`profile-data-integrity-instructions.md`** - Data validation and integrity standards

### Key Features Covered

**UI Design System & Consistency:**
- Standardized border styling across all components using semantic CSS tokens
- Base Card component standardization (1px borders vs 2px inconsistency)
- Comprehensive border-style-consistency instructions for maintaining visual refinement
- Fixed admin dashboard vs analytics card border weight discrepancies

**Email System (Production Ready):**
- Queue-based delivery with retry logic and race condition prevention
- Enhanced duplicate detection including pending status checks
- BCC functionality for bookkeeper on all receipt emails
- Real-time admin monitoring with reliable status tracking

**Payment Processing:**
- Stripe webhook integration with comprehensive error handling
- Dynamic coupon system supporting percentage, fixed, and 100% discounts
- E-transfer support with manual payment entry capabilities
- Zero-amount payment handling that properly skips payment interfaces

**Administrative Tools:**
- Application review workflow with batch operations
- Real-time analytics dashboard with metrics calculation
- License monitoring and renewal reminder system
- Comprehensive refund processing with Stripe integration

**Document Generation:**
- Automated PDF generation for licenses, certificates, and agreements
- Dynamic content injection with QR code integration
- Tax calculation logic with proper disclaimer requirements

**File Management:**
- Object storage integration with Google Cloud Storage backend
- Standardized file upload processes across all license pathways
- Secure file handling with proper validation and size limits

## Development & Maintenance

### Database Schema Management
- **Schema Definition**: All database models are defined in `shared/schema.ts`
- **Migrations**: Use `npm run db:push` to sync schema changes (use `--force` if needed)
- **Data Integrity**: Never manually write SQL migrations - always use Drizzle ORM

### Key Development Scripts
- `npm run dev` - Start development server (Express + Vite)
- `npm run db:push` - Sync database schema changes
- `npm run build` - Build production application

### Testing Instructions
Comprehensive testing instructions are available for each pathway:
- `PERSONAL_USE_TESTING_INSTRUCTIONS.md`
- `EDUCATIONAL_TESTING_INSTRUCTIONS.md`
- `NON_PROFIT_SMALL_BUSINESS_TESTING_INSTRUCTIONS.md`
- `MEDIUM_LARGE_BUSINESS_TESTING_INSTRUCTIONS.md`
- `CERTIFIED_RESELLER_TESTING_INSTRUCTIONS.md`

### Monitoring & Analytics
- **Comprehensive Analytics Dashboard**: Real-time business intelligence with financial metrics, tax compliance, operational efficiency, and user behavior tracking
- **Financial Analytics**: Revenue tracking with GST calculations, provincial tax breakdowns, and QuickBooks export integration
- **User Behavior Tracking**: Google Analytics 4/GTM integration with complete funnel analysis and conversion tracking
- **Tax Compliance**: Automated GST calculation, provincial reporting, and remittance preparation for Canadian tax requirements
- **Operational Intelligence**: Processing time monitoring, approval rate analysis, and efficiency metrics
- **Real-time Data**: 5-minute refresh intervals with sub-2-second dashboard load times

### File Management
- **Receipt Generation**: Direct database-to-PDF generation system in `server/utils/license-receipt.ts`
- **File Cleanup**: Use `cleanup_all_orphaned_receipts.js` for maintenance
- **Object Storage**: Integrated with Replit Object Storage for persistent file management

## Live Application

This application is deployed and running on Replit. Visit the live application to see it in action.

## License

This project is proprietary and owned by the Orange Shirt Society. All rights reserved.

## Acknowledgements

The Orange Shirt Society is a not-for-profit organization dedicated to supporting Indian Residential School reconciliation, creating awareness of the individual, family, and community intergenerational impacts of Indian Residential Schools through our programs, and promoting the truth that Every Child Matters.

100% of funds from Orange Shirt Society licensing support their mission to support Indian Residential School reconciliation, to create awareness of the individual, family, and community intergenerational impacts of Indian Residential Schools through our programs, and to promote the truth that Every Child Matters.